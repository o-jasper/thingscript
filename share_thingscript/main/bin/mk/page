#!/bin/bash
#
#  Copyright (C) 30-05-2013 Jasper den Ouden.
#
#  This is free software: you can redistribute it and/or modify
#  it under the terms of the GNU General Public License as published
# by the Free Software Foundation, either version 3 of the License, or
# (at your option) any later version.
#

if [ "$1" != "" ]; then
    cd $1
    export OPWD=$OPWD
    export PWD=$PWD
fi

#See if we have the required stuff. #TODO move somewhere else.
MISSING=''
for el in `echo author category title`; do
    if [ "`thingscript get $el`" == "" ]; then
        MISSING=$MISSING" $el"
    fi
done
for el in `echo short_description license el/layout`; do
    if [ "`thingscript get_page $el`" == "" ]; then
        MISSING=$MISSING" $el"
    fi
done
if [ "$MISSING" != "" ]; then
    echo '
Error: For each line, in the directory '$1/thingscript/'
_one_ of the files is required:' > /dev/stderr
    echo $MISSING | tr ' ' '\n' > /dev/stderr
    echo '
Use \`thingscript get help/\$FILE\` for information about the file.
 These were the arguments used '$@ > /dev/stderr
    exit
fi
#(Beyond the above files are optional, missing ignored)

FROM=$2 #Default layout is 'layout' as `thingscript getpage` gets.
if [ "$2" == "" ]; then
    FROM=el/layout
fi
TO=$3
if [ "$3" == "" ]; then
    TO=index.html
fi
if [ "$TO" == "stdout" ]; then
    thingscript handle_get $FROM 
else
    thingscript handle_get $FROM > $TO
fi
