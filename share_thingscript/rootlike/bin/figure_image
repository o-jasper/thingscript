#!/bin/bash
#
#  Copyright (C) 30-05-2013 Jasper den Ouden.
#
#  This is free software: you can redistribute it and/or modify
#  it under the terms of the GNU General Public License as published
# by the Free Software Foundation, either version 3 of the License, or
# (at your option) any later version.
#

# Figures out an image from an file, puts it in the local `tso/`(thing script output)
# Arguments: just the given file.

file=$1
ofile=`tso $file yes`

case $file in
    *.stl)
        memoize $file $ofile.data get_stl_info with_stdout | \
             memoize $file $ofile.pov stl2pov no_stdout > /dev/stderr
        if_newer $ofile.pov $ofile.png "`thingscript get scripts/povray` $ofile.pov $ofile.png"
        figure_image $ofile.png;;
#TODO optionally figure out the cheapest option.(.png/.gif/.jpg) (by generating them all)
# and hammer down file sizes.
    *.gif)
        echo $file;;
    *.jpg)
        echo $file;;
    *.png)
        echo $file;;
    *)
        echo Dont know how to generate image from $file > /dev/stderr
        echo $file;;
esac
